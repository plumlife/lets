%%% -*- mode: erlang -*-

{require_min_otp_vsn, "R16"}.

{pre_hooks, [ {clean,   "c_src/build_deps.sh clean"}
            , {compile, "c_src/build_deps.sh get_deps"}
            , {compile, "c_src/build_deps.sh"}
            ]}.

{port_env, [ {"CFLAGS",     " "}
           , {"CXXFLAGS",   " "}
           , {"LDFLAGS",    "-L/opt/arm/lib/erlang/lib/erl_interface-3.7.20/lib -lerl_interface -lei "}
           , {"DRV_CFLAGS", "$DRV_CFLAGS -fPIC -O3 -Wall -Wextra -Werror -Wno-unused-parameter -Wno-missing-field-initializers"}
           , {"CC",     "/root/x-tools/arm-plum-linux-gnueabi/bin/arm-plum-linux-gnueabi-gcc"}
           , {"CXX",    "/root/x-tools/arm-plum-linux-gnueabi/bin/arm-plum-linux-gnueabi-g++"}
           , {"AR",     "/root/x-tools/arm-plum-linux-gnueabi/bin/arm-plum-linux-gnueabi-ar"}
           , {"RANLIB", "/root/x-tools/arm-plum-linux-gnueabi/bin/arm-plum-linux-gnueabi-ranlib"}
          ]}.
{port_specs, [{".*", "priv/lib/lets_impl_drv.so", ["c_src/lets_impl_drv_lib.cc", "c_src/lets_impl_drv.cc"],
               [{env, [{"DRV_CFLAGS", "$DRV_CFLAGS -I c_src/leveldb/include"}
                      , {"DRV_LDFLAGS", "$DRV_LDFLAGS c_src/leveldb/lib/libleveldb.a c_src/snappy/lib/libsnappy.a -lstdc++"}
                      ]}]}
             , {".*", "priv/lib/lets_impl_nif.so", ["c_src/lets_impl_nif_lib.cc", "c_src/lets_impl_nif.cc"],
                [{env, [{"DRV_CFLAGS", "$DRV_CFLAGS -I c_src/leveldb/include"}
                       , {"DRV_LDFLAGS", "$DRV_LDFLAGS c_src/leveldb/lib/libleveldb.a c_src/snappy/lib/libsnappy.a -lstdc++"}
                       ]}]}
             ]}.

{erl_opts, [warnings_as_errors, warn_shadow_vars, warn_obsolete_guard]}.

{xref_checks, [undefined_function_calls, undefined_functions,
               deprecated_function_calls, deprecated_functions]}.

{deps, [ {qc,      "2.0.2", {git, "git://github.com/norton/qc.git",        {tag, "v2.0.2"}}}
       , {gen_ets, "2.0.0", {git, "git://github.com/norton/gen-ets.git",   {tag, "v2.0.0"}}}
       , {sext,    ".*",   {git, "git://github.com/uwiger/sext.git",      "47e80ec6051727af0ac04d93d52c0ea9728faa32"}}
       , {edown,   "0.6",   {git, "git://github.com/norton/edown.git",     {tag, "0.6"}}}
       ]}.
